import{S as e,i as t,s as a,m as r,e as l,t as c,o,c as s,a as n,d as i,b as h,f,J as d,h as u,j as g,p as m,q as p,r as _,v as x,M as y,N as w,O as v,k as b,l as E,w as A}from"./index.dfef896d.js";import{A as k}from"./api.2d894ecb.js";import{S as I}from"./StreamerAutoComplete.78c19bae.js";const{document:R}=v;function S(e){var t,a,w,v,k,S,$,V,D,L,M,C,P,T,B,N,j,F,U,q,J,O,W,X,Y,z,G,H,K,Q,Z,ee,te,ae;function re(t){e.streamerautocomplete_selected_binding.call(null,t),v=!0,A(()=>v=!1)}let le={streamers:e.streamers,placeholder:"지도에서 찾기"};void 0!==e.search&&(le.selected=e.search);var ce=new I({props:le});return b.push(()=>E(ce,"selected",re)),{c(){t=r(),a=l("div"),w=l("div"),ce.$$.fragment.c(),k=r(),S=l("div"),$=l("div"),V=l("input"),D=r(),L=l("label"),M=c("국경"),C=r(),P=l("div"),T=l("input"),B=r(),N=l("label"),j=c("초상화"),F=r(),U=l("div"),q=l("input"),J=r(),O=l("label"),W=c("흑백"),X=r(),Y=l("div"),z=l("input"),G=r(),H=l("label"),K=c("이름"),Q=r(),Z=l("div"),ee=l("canvas"),this.h()},l(e){t=o(e),a=s(e,"DIV",{class:!0},!1);var r=n(a);w=s(r,"DIV",{class:!0},!1);var l=n(w);ce.$$.fragment.l(l),l.forEach(i),k=o(r),S=s(r,"DIV",{class:!0},!1);var c=n(S);$=s(c,"DIV",{class:!0},!1);var f=n($);V=s(f,"INPUT",{type:!0,id:!0,name:!0},!1),n(V).forEach(i),D=o(f),L=s(f,"LABEL",{for:!0},!1);var d=n(L);M=h(d,"국경"),d.forEach(i),f.forEach(i),C=o(c),P=s(c,"DIV",{class:!0},!1);var u=n(P);T=s(u,"INPUT",{type:!0,id:!0,name:!0},!1),n(T).forEach(i),B=o(u),N=s(u,"LABEL",{for:!0},!1);var g=n(N);j=h(g,"초상화"),g.forEach(i),u.forEach(i),F=o(c),U=s(c,"DIV",{class:!0},!1);var m=n(U);q=s(m,"INPUT",{type:!0,id:!0,name:!0},!1),n(q).forEach(i),J=o(m),O=s(m,"LABEL",{for:!0},!1);var p=n(O);W=h(p,"흑백"),p.forEach(i),m.forEach(i),X=o(c),Y=s(c,"DIV",{class:!0},!1);var _=n(Y);z=s(_,"INPUT",{type:!0,id:!0,name:!0},!1),n(z).forEach(i),G=o(_),H=s(_,"LABEL",{for:!0},!1);var x=n(H);K=h(x,"이름"),x.forEach(i),_.forEach(i),c.forEach(i),r.forEach(i),Q=o(e),Z=s(e,"DIV",{class:!0},!1);var y=n(Z);ee=s(y,"CANVAS",{width:!0,height:!0},!1),n(ee).forEach(i),y.forEach(i),this.h()},h(){R.title="스트리머 지도",f(w,"class","p-2"),f(V,"type","checkbox"),f(V,"id","border"),f(V,"name","border"),f(L,"for","border"),f($,"class","px-2"),f(T,"type","checkbox"),f(T,"id","potrait"),f(T,"name","potrait"),f(N,"for","potrait"),f(P,"class","px-2"),f(q,"type","checkbox"),f(q,"id","saturate"),f(q,"name","saturate"),f(O,"for","saturate"),f(U,"class","px-2"),f(z,"type","checkbox"),f(z,"id","name"),f(z,"name","name"),f(H,"for","name"),f(Y,"class","px-2"),f(S,"class","p-2 flex flex-row flex-wrap items-center"),f(a,"class","w-full flex flex-row flex-wrap items-center my-4"),f(ee,"width","1280"),f(ee,"height","1280"),f(Z,"class","overflow-x-auto container"),ae=[d(V,"change",e.input0_change_handler),d(T,"change",e.input1_change_handler),d(q,"change",e.input2_change_handler),d(z,"change",e.input3_change_handler)]},m(r,l){u(r,t,l),u(r,a,l),g(a,w),m(ce,w,null),g(a,k),g(a,S),g(S,$),g($,V),V.checked=e.clustering_show,g($,D),g($,L),g(L,M),g(S,C),g(S,P),g(P,T),T.checked=e.potrait_show,g(P,B),g(P,N),g(N,j),g(S,F),g(S,U),g(U,q),q.checked=e.saturate_filter,g(U,J),g(U,O),g(O,W),g(S,X),g(S,Y),g(Y,z),z.checked=e.name_show,g(Y,G),g(Y,H),g(H,K),u(r,Q,l),u(r,Z,l),g(Z,ee),e.canvas_1_binding(ee),te=!0},p(e,t){var a={};e.streamers&&(a.streamers=t.streamers),!v&&e.search&&(a.selected=t.search),ce.$set(a),e.clustering_show&&(V.checked=t.clustering_show),e.potrait_show&&(T.checked=t.potrait_show),e.saturate_filter&&(q.checked=t.saturate_filter),e.name_show&&(z.checked=t.name_show)},i(e){te||(p(ce.$$.fragment,e),te=!0)},o(e){_(ce.$$.fragment,e),te=!1},d(r){r&&(i(t),i(a)),x(ce),r&&(i(Q),i(Z)),e.canvas_1_binding(null),y(ae)}}}async function $(e,t){return{streamers:await k.streamer_map.call(this)}}const V=6,D=0;function L(e,t,a){let r,l,c,{streamers:o}=t,s="",n=!0,i=!0,h=!0,f=!1,d=null,u=0,g=0,m=!1;const p=["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],_=[[[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],[[1,0,1,1],[1,1,0,1],[1,1,1,0],[0,1,1,1]],[[1,0,1,0],[0,1,0,1],[1,0,1,0],[0,1,0,1]],[[1,1,1,1],[0,0,0,0],[1,1,1,1],[0,0,0,0]],[[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1]]];function x(e,t,a){e.strokeStyle=a,e.fillStyle=a,e.globalAlpha=.5,e.fillRect(t.coordx,t.coordy,l,c),e.globalAlpha=1,e.lineWidth=D,e.strokeRect(t.coordx,t.coordy,l,c)}return w(async()=>{a("canvas",r.ondblclick=function(){for(let e of o)u<e.coordx+l&&u>=e.coordx&&g<e.coordy+c&&g>=e.coordy&&(location=`/streamer/${e.id}`)},r);const e=document.createElement("canvas"),t=e.getContext("2d");e.width=4,e.height=4;const y=[],w=[];for(let e=0;e<_.length;++e)for(let t=0;t<p.length;++t)y.push(v(e,p[t],p[(t+1)%p.length])),w.push(p[t]);function v(a,r,l=null,c=1){e.width=_[a].length,e.height=_[0].length,t.clearRect(0,0,e.width,e.height),t.fillStyle=r,t.globalAlpha=c;for(let r=0;r<e.width;++r)for(let l=0;l<e.height;++l)_[a][r][l]&&t.fillRect(r,l,1,1);if(l){t.fillStyle=l;for(let r=0;r<e.width;++r)for(let l=0;l<e.height;++l)_[a][r][l]||t.fillRect(r,l,1,1)}return t.createPattern(e,"repeat")}let b,E=r.getContext("2d"),A=document.createElement("canvas"),k=A.getContext("2d"),I=document.createElement("canvas"),R=I.getContext("2d");A.width=r.width,A.height=r.height,I.width=r.width,I.height=r.height,a("canvas",r.onmousemove=function(e){let t=e.target.getBoundingClientRect();u=e.clientX-t.left,g=e.clientY-t.top,m=!0},r),a("canvas",r.onmouseout=function(e){m=!1},r),a("streamers",o=(()=>{let e=Math.ceil(Math.sqrt(o.length));l=r.width/e-2*D,c=r.height/e-2*D;let t=Array(e).fill().map(()=>Array(e).fill(null));for(let e of o)t[e.x][e.y]=e;for(let e of o){let a=(l+2*D)*e.x+D,r=(c+2*D)*e.y+D;e.cluster>=0&&(e.x-1<0||null==t[e.x-1][e.y]||t[e.x-1][e.y].cluster!=e.cluster)&&(e.left_edge=!0),e.cluster>=0&&(e.x+1>=t.length||null==t[e.x+1][e.y]||t[e.x+1][e.y].cluster!=e.cluster)&&(e.right_edge=!0),e.cluster>=0&&(e.y-1<0||null==t[e.x][e.y-1]||t[e.x][e.y-1].cluster!=e.cluster)&&(e.top_edge=!0),e.cluster>=0&&(e.y+1>=t.length||null==t[e.x][e.y+1]||t[e.x][e.y+1].cluster!=e.cluster)&&(e.bottom_edge=!0);let o=new Image;o.onload=function(){k.drawImage(o,e.coordx,e.coordy,l,c)},o.src=e.profile_image_url,R.font="10px Arial";let s=a+V,n=l-2*V,i=R.measureText(e.name).width,h=Math.ceil(i/n),f=Math.floor(e.name.length/h),d=parseInt(R.font),u=d*h,g=r+c-u-V;R.globalAlpha=.7,R.fillStyle="#fff",R.fillRect(s,g,n,u),R.globalAlpha=1,R.fillStyle="#000",R.textBaseline="top",R.textAlign="center";for(let t=0;t<h-1;++t)R.fillText(e.name.substr(t*f,f),a+.5*l,g+t*d);R.fillText(e.name.slice((h-1)*f),a+.5*l,g+(h-1)*d),e.coordx=a,e.coordy=r}return o})());let S=0;return E.font="11px Arial",function e(){b=requestAnimationFrame(e),E.clearRect(0,0,r.width,r.height),E.save(),f&&(E.filter="saturate(10%)"),i&&E.drawImage(A,0,0),E.restore();for(let e of o)if(n&&e.cluster>=0){w[e.cluster];let t=y[e.cluster];if(E.fillStyle=t,d&&e.cluster>-1&&d.cluster===e.cluster&&S%10>5);else{if(e.left_edge){let t=e.coordy,a=t+c;e.bottom_edge||(a+=V),e.top_edge||(t-=V),E.fillRect(e.coordx,t,V,a-t)}if(e.right_edge){let t=e.coordy,a=t+c;e.bottom_edge||(a+=V),e.top_edge||(t-=V),E.fillRect(e.coordx+l-V,t,V,a-t)}if(e.top_edge){let t=e.coordx,a=t+l;e.right_edge||(a+=V),e.left_edge||(t-=V),E.fillRect(t,e.coordy,a-t,V)}if(e.bottom_edge){let t=e.coordx,a=t+l;e.right_edge||(a+=V),e.left_edge||(t-=V),E.fillRect(t,e.coordy+c-V,a-t,V)}}}if(h&&E.drawImage(I,0,0),m){for(let e of o)u<e.coordx+l&&u>=e.coordx&&g<e.coordy+c&&g>=e.coordy&&(d=e);d&&(x(E,d,"#d4af37"),s&&d.id==s.id&&a("search",s=""))}else d=null;s&&S%10>5&&x(E,s,"#d4af37"),E.save();for(let e of o)e.is_streaming&&(E.beginPath(),E.globalAlpha=Math.abs(Math.sin(S/20)),E.arc(e.coordx+V+4,e.coordy+V+4,3,0,2*Math.PI,!1),E.fillStyle="#FF4560",E.fill());E.restore(),S+=1}(),()=>{cancelAnimationFrame(b)}}),e.$set=(e=>{"streamers"in e&&a("streamers",o=e.streamers)}),{streamers:o,canvas:r,search:s,clustering_show:n,potrait_show:i,name_show:h,saturate_filter:f,streamerautocomplete_selected_binding:function(e){a("search",s=e)},input0_change_handler:function(){n=this.checked,a("clustering_show",n)},input1_change_handler:function(){i=this.checked,a("potrait_show",i)},input2_change_handler:function(){f=this.checked,a("saturate_filter",f)},input3_change_handler:function(){h=this.checked,a("name_show",h)},canvas_1_binding:function(e){b[e?"unshift":"push"](()=>{a("canvas",r=e)})}}}export default class extends e{constructor(e){super(),t(this,e,L,S,a,["streamers"])}}export{$ as preload};
