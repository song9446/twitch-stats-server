import{S as e,i as t,s as a,k as r,l,e as c,m as o,t as s,c as n,a as i,d as h,o as f,b as d,f as u,J as g,h as m,j as p,p as _,q as x,r as y,v as w,M as v,N as b,w as E,y as k,n as A}from"./index.dfef896d.js";import{A as $}from"./api.2d894ecb.js";import{S as I}from"./StreamerAutoComplete.78c19bae.js";function R(e){var t,a,b,k,A,$,R,S,V,D,L,C,T,B,N,M,P,j,U,q,F,J,W,X,Y,z,G,H,K,O,Q,Z,ee;function te(t){e.streamerautocomplete_selected_binding.call(null,t),b=!0,E(()=>b=!1)}let ae={streamers:e.streamers,placeholder:"지도에서 찾기"};void 0!==e.search&&(ae.selected=e.search);var re=new I({props:ae});return r.push(()=>l(re,"selected",te)),{c(){t=c("div"),a=c("div"),re.$$.fragment.c(),k=o(),A=c("div"),$=c("div"),R=c("input"),S=o(),V=c("label"),D=s("국경"),L=o(),C=c("div"),T=c("input"),B=o(),N=c("label"),M=s("초상화"),P=o(),j=c("div"),U=c("input"),q=o(),F=c("label"),J=s("흑백"),W=o(),X=c("div"),Y=c("input"),z=o(),G=c("label"),H=s("이름"),K=o(),O=c("div"),Q=c("canvas"),this.h()},l(e){t=n(e,"DIV",{class:!0},!1);var r=i(t);a=n(r,"DIV",{class:!0},!1);var l=i(a);re.$$.fragment.l(l),l.forEach(h),k=f(r),A=n(r,"DIV",{class:!0},!1);var c=i(A);$=n(c,"DIV",{class:!0},!1);var o=i($);R=n(o,"INPUT",{type:!0,id:!0,name:!0},!1),i(R).forEach(h),S=f(o),V=n(o,"LABEL",{for:!0},!1);var s=i(V);D=d(s,"국경"),s.forEach(h),o.forEach(h),L=f(c),C=n(c,"DIV",{class:!0},!1);var u=i(C);T=n(u,"INPUT",{type:!0,id:!0,name:!0},!1),i(T).forEach(h),B=f(u),N=n(u,"LABEL",{for:!0},!1);var g=i(N);M=d(g,"초상화"),g.forEach(h),u.forEach(h),P=f(c),j=n(c,"DIV",{class:!0},!1);var m=i(j);U=n(m,"INPUT",{type:!0,id:!0,name:!0},!1),i(U).forEach(h),q=f(m),F=n(m,"LABEL",{for:!0},!1);var p=i(F);J=d(p,"흑백"),p.forEach(h),m.forEach(h),W=f(c),X=n(c,"DIV",{class:!0},!1);var _=i(X);Y=n(_,"INPUT",{type:!0,id:!0,name:!0},!1),i(Y).forEach(h),z=f(_),G=n(_,"LABEL",{for:!0},!1);var x=i(G);H=d(x,"이름"),x.forEach(h),_.forEach(h),c.forEach(h),r.forEach(h),K=f(e),O=n(e,"DIV",{class:!0},!1);var y=i(O);Q=n(y,"CANVAS",{width:!0,height:!0},!1),i(Q).forEach(h),y.forEach(h),this.h()},h(){u(a,"class","p-2"),u(R,"type","checkbox"),u(R,"id","border"),u(R,"name","border"),u(V,"for","border"),u($,"class","px-2"),u(T,"type","checkbox"),u(T,"id","potrait"),u(T,"name","potrait"),u(N,"for","potrait"),u(C,"class","px-2"),u(U,"type","checkbox"),u(U,"id","saturate"),u(U,"name","saturate"),u(F,"for","saturate"),u(j,"class","px-2"),u(Y,"type","checkbox"),u(Y,"id","name"),u(Y,"name","name"),u(G,"for","name"),u(X,"class","px-2"),u(A,"class","p-2 flex flex-row flex-wrap items-center"),u(t,"class","w-full flex flex-row flex-wrap items-center my-4"),u(Q,"width","1280"),u(Q,"height","1280"),u(O,"class","overflow-x-auto container"),ee=[g(R,"change",e.input0_change_handler),g(T,"change",e.input1_change_handler),g(U,"change",e.input2_change_handler),g(Y,"change",e.input3_change_handler)]},m(r,l){m(r,t,l),p(t,a),_(re,a,null),p(t,k),p(t,A),p(A,$),p($,R),R.checked=e.clustering_show,p($,S),p($,V),p(V,D),p(A,L),p(A,C),p(C,T),T.checked=e.potrait_show,p(C,B),p(C,N),p(N,M),p(A,P),p(A,j),p(j,U),U.checked=e.saturate_filter,p(j,q),p(j,F),p(F,J),p(A,W),p(A,X),p(X,Y),Y.checked=e.name_show,p(X,z),p(X,G),p(G,H),m(r,K,l),m(r,O,l),p(O,Q),e.canvas_1_binding(Q),Z=!0},p(e,t){var a={};e.streamers&&(a.streamers=t.streamers),!b&&e.search&&(a.selected=t.search),re.$set(a),e.clustering_show&&(R.checked=t.clustering_show),e.potrait_show&&(T.checked=t.potrait_show),e.saturate_filter&&(U.checked=t.saturate_filter),e.name_show&&(Y.checked=t.name_show)},i(e){Z||(x(re.$$.fragment,e),Z=!0)},o(e){y(re.$$.fragment,e),Z=!1},d(a){a&&h(t),w(re),a&&(h(K),h(O)),e.canvas_1_binding(null),v(ee)}}}const S=6,V=0;function D(e,t,a){let l,c,o,s,n="",i=!0,h=!0,f=!0,d=!0,u=null,g=0,m=0,p=!1;const _=["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],x=[[[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],[[1,0,1,1],[1,1,0,1],[1,1,1,0],[0,1,1,1]],[[1,0,1,0],[0,1,0,1],[1,0,1,0],[0,1,0,1]],[[1,1,1,1],[0,0,0,0],[1,1,1,1],[0,0,0,0]],[[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1]]];function y(e,t,a){e.strokeStyle=a,e.fillStyle=a,e.globalAlpha=.5,e.fillRect(t.coordx,t.coordy,o,s),e.globalAlpha=1,e.lineWidth=V,e.strokeRect(t.coordx,t.coordy,o,s)}return b(async()=>{a("streamers",l=await $.streamer_map.call(this)),a("canvas",c.ondblclick=function(){for(let e of l)g<e.coordx+o&&g>=e.coordx&&m<e.coordy+s&&m>=e.coordy&&(location=`/streamer/${e.id}`)},c);const e=document.createElement("canvas"),t=e.getContext("2d");e.width=4,e.height=4;const r=[],w=[];for(let e=0;e<x.length;++e)for(let t=0;t<_.length;++t)r.push(v(e,_[t],_[(t+1)%_.length])),w.push(_[t]);function v(a,r,l=null,c=1){e.width=x[a].length,e.height=x[0].length,t.clearRect(0,0,e.width,e.height),t.fillStyle=r,t.globalAlpha=c;for(let r=0;r<e.width;++r)for(let l=0;l<e.height;++l)x[a][r][l]&&t.fillRect(r,l,1,1);if(l){t.fillStyle=l;for(let r=0;r<e.width;++r)for(let l=0;l<e.height;++l)x[a][r][l]||t.fillRect(r,l,1,1)}return t.createPattern(e,"repeat")}let b,E=c.getContext("2d"),k=document.createElement("canvas"),A=k.getContext("2d"),I=document.createElement("canvas"),R=I.getContext("2d");k.width=c.width,k.height=c.height,I.width=c.width,I.height=c.height,a("canvas",c.onmousemove=function(e){let t=e.target.getBoundingClientRect();g=e.clientX-t.left,m=e.clientY-t.top,p=!0},c),a("canvas",c.onmouseout=function(e){p=!1},c),a("streamers",l=(()=>{let e=Math.ceil(Math.sqrt(l.length));o=c.width/e-2*V,s=c.height/e-2*V;let t=Array(e).fill().map(()=>Array(e).fill(null));for(let e of l)t[e.x][e.y]=e;for(let e of l){let a=(o+2*V)*e.x+V,r=(s+2*V)*e.y+V;e.cluster>=0&&(e.x-1<0||null==t[e.x-1][e.y]||t[e.x-1][e.y].cluster!=e.cluster)&&(e.left_edge=!0),e.cluster>=0&&(e.x+1>=t.length||null==t[e.x+1][e.y]||t[e.x+1][e.y].cluster!=e.cluster)&&(e.right_edge=!0),e.cluster>=0&&(e.y-1<0||null==t[e.x][e.y-1]||t[e.x][e.y-1].cluster!=e.cluster)&&(e.top_edge=!0),e.cluster>=0&&(e.y+1>=t.length||null==t[e.x][e.y+1]||t[e.x][e.y+1].cluster!=e.cluster)&&(e.bottom_edge=!0);let l=new Image;l.onload=function(){A.drawImage(l,e.coordx,e.coordy,o,s)},l.src=e.profile_image_url,R.font="10px Arial";let c=a+S,n=o-2*S,i=R.measureText(e.name).width,h=Math.ceil(i/n),f=Math.floor(e.name.length/h),d=parseInt(R.font),u=d*h,g=r+s-u-S;R.globalAlpha=.5,R.fillStyle="#fff",R.fillRect(c,g,n,u),R.globalAlpha=1,R.fillStyle="#000",R.textBaseline="top",R.textAlign="center";for(let t=0;t<h-1;++t)R.fillText(e.name.substr(t*f,f),a+.5*o,g+t*d);R.fillText(e.name.slice((h-1)*f),a+.5*o,g+(h-1)*d),e.coordx=a,e.coordy=r}return l})());let D=0;return E.font="11px Arial",function e(){b=requestAnimationFrame(e),E.clearRect(0,0,c.width,c.height),E.save(),d&&(E.filter="saturate(10%)"),h&&E.drawImage(k,0,0),E.restore();for(let e of l)if(i&&e.cluster>=0){w[e.cluster];let t=r[e.cluster];if(E.fillStyle=t,u&&e.cluster>-1&&u.cluster===e.cluster&&D%10>5);else{if(e.left_edge){let t=e.coordy,a=t+s;e.bottom_edge||(a+=S),e.top_edge||(t-=S),E.fillRect(e.coordx,t,S,a-t)}if(e.right_edge){let t=e.coordy,a=t+s;e.bottom_edge||(a+=S),e.top_edge||(t-=S),E.fillRect(e.coordx+o-S,t,S,a-t)}if(e.top_edge){let t=e.coordx,a=t+o;e.right_edge||(a+=S),e.left_edge||(t-=S),E.fillRect(t,e.coordy,a-t,S)}if(e.bottom_edge){let t=e.coordx,a=t+o;e.right_edge||(a+=S),e.left_edge||(t-=S),E.fillRect(t,e.coordy+s-S,a-t,S)}}}if(f&&E.drawImage(I,0,0),p){for(let e of l)g<e.coordx+o&&g>=e.coordx&&m<e.coordy+s&&m>=e.coordy&&(u=e);u&&(y(E,u,"#d4af37"),n&&u.id==n.id&&a("search",n=""))}else u=null;n&&D%10>5&&y(E,n,"#d4af37"),D+=1}(),()=>{cancelAnimationFrame(b)}}),{streamers:l,canvas:c,search:n,clustering_show:i,potrait_show:h,name_show:f,saturate_filter:d,streamerautocomplete_selected_binding:function(e){a("search",n=e)},input0_change_handler:function(){i=this.checked,a("clustering_show",i)},input1_change_handler:function(){h=this.checked,a("potrait_show",h)},input2_change_handler:function(){d=this.checked,a("saturate_filter",d)},input3_change_handler:function(){f=this.checked,a("name_show",f)},canvas_1_binding:function(e){r[e?"unshift":"push"](()=>{a("canvas",c=e)})}}}class L extends e{constructor(e){super(),t(this,e,D,R,a,[])}}function C(e){var t,a,r,l,s=new L({});return{c(){t=o(),a=c("a"),r=o(),s.$$.fragment.c(),this.h()},l(e){t=f(e),a=n(e,"A",{href:!0,style:!0},!1),i(a).forEach(h),r=f(e),s.$$.fragment.l(e),this.h()},h(){document.title="스트리머 지도",u(a,"href","hidden-links"),k(a,"visibility","hidden"),k(a,"position","absolute")},m(e,c){m(e,t,c),m(e,a,c),m(e,r,c),_(s,e,c),l=!0},p:A,i(e){l||(x(s.$$.fragment,e),l=!0)},o(e){y(s.$$.fragment,e),l=!1},d(e){e&&(h(t),h(a),h(r)),w(s,e)}}}export default class extends e{constructor(e){super(),t(this,e,null,C,a,[])}}
