import{S as e,i as t,s as a,w as l,x as r,e as i,a as n,t as s,c,b as h,d as o,f,g as d,h as u,l as g,j as _,k as m,y as p,z as x,A as w,B as y,v as b,N as v,C as E}from"./index.1cf7c1a4.js";import{S as k}from"./StreamerAutoComplete.8a6c7cc9.js";import{A}from"./config.c223256a.js";function I(e){var t,a,v,A,I,R,S,M,V,$,j,C,D,L,B,T,N,q,P,U,F,z,W,X,Y,G,H,J,K,O,Q,Z,ee;function te(t){e.streamerautocomplete_selected_binding.call(null,t),v=!0,E(()=>v=!1)}let ae={streamers:e.streamers,placeholder:"지도에서 찾기"};void 0!==e.search&&(ae.selected=e.search);var le=new k({props:ae});return l.push(()=>r(le,"selected",te)),{c(){t=i("div"),a=i("div"),le.$$.fragment.c(),A=n(),I=i("div"),R=i("div"),S=i("input"),M=n(),V=i("label"),$=s("국경"),j=n(),C=i("div"),D=i("input"),L=n(),B=i("label"),T=s("초상화"),N=n(),q=i("div"),P=i("input"),U=n(),F=i("label"),z=s("흑백"),W=n(),X=i("div"),Y=i("input"),G=n(),H=i("label"),J=s("이름"),K=n(),O=i("div"),Q=i("canvas"),this.h()},l(e){t=c(e,"DIV",{class:!0},!1);var l=h(t);a=c(l,"DIV",{class:!0},!1);var r=h(a);le.$$.fragment.l(r),r.forEach(o),A=f(l),I=c(l,"DIV",{class:!0},!1);var i=h(I);R=c(i,"DIV",{class:!0},!1);var n=h(R);S=c(n,"INPUT",{type:!0,id:!0,name:!0},!1),h(S).forEach(o),M=f(n),V=c(n,"LABEL",{for:!0},!1);var s=h(V);$=d(s,"국경"),s.forEach(o),n.forEach(o),j=f(i),C=c(i,"DIV",{class:!0},!1);var u=h(C);D=c(u,"INPUT",{type:!0,id:!0,name:!0},!1),h(D).forEach(o),L=f(u),B=c(u,"LABEL",{for:!0},!1);var g=h(B);T=d(g,"초상화"),g.forEach(o),u.forEach(o),N=f(i),q=c(i,"DIV",{class:!0},!1);var _=h(q);P=c(_,"INPUT",{type:!0,id:!0,name:!0},!1),h(P).forEach(o),U=f(_),F=c(_,"LABEL",{for:!0},!1);var m=h(F);z=d(m,"흑백"),m.forEach(o),_.forEach(o),W=f(i),X=c(i,"DIV",{class:!0},!1);var p=h(X);Y=c(p,"INPUT",{type:!0,id:!0,name:!0},!1),h(Y).forEach(o),G=f(p),H=c(p,"LABEL",{for:!0},!1);var x=h(H);J=d(x,"이름"),x.forEach(o),p.forEach(o),i.forEach(o),l.forEach(o),K=f(e),O=c(e,"DIV",{class:!0},!1);var w=h(O);Q=c(w,"CANVAS",{width:!0,height:!0},!1),h(Q).forEach(o),w.forEach(o),this.h()},h(){u(a,"class","p-2"),u(S,"type","checkbox"),u(S,"id","border"),u(S,"name","border"),u(V,"for","border"),u(R,"class","px-2"),u(D,"type","checkbox"),u(D,"id","potrait"),u(D,"name","potrait"),u(B,"for","potrait"),u(C,"class","px-2"),u(P,"type","checkbox"),u(P,"id","saturate"),u(P,"name","saturate"),u(F,"for","saturate"),u(q,"class","px-2"),u(Y,"type","checkbox"),u(Y,"id","name"),u(Y,"name","name"),u(H,"for","name"),u(X,"class","px-2"),u(I,"class","p-2 flex flex-row flex-wrap items-center"),u(t,"class","w-full flex flex-row flex-wrap items-center my-4"),u(Q,"width","1280"),u(Q,"height","1280"),u(O,"class","overflow-x-auto container"),ee=[g(S,"change",e.input0_change_handler),g(D,"change",e.input1_change_handler),g(P,"change",e.input2_change_handler),g(Y,"change",e.input3_change_handler)]},m(l,r){_(l,t,r),m(t,a),p(le,a,null),m(t,A),m(t,I),m(I,R),m(R,S),S.checked=e.clustering_show,m(R,M),m(R,V),m(V,$),m(I,j),m(I,C),m(C,D),D.checked=e.potrait_show,m(C,L),m(C,B),m(B,T),m(I,N),m(I,q),m(q,P),P.checked=e.saturate_filter,m(q,U),m(q,F),m(F,z),m(I,W),m(I,X),m(X,Y),Y.checked=e.name_show,m(X,G),m(X,H),m(H,J),_(l,K,r),_(l,O,r),m(O,Q),e.canvas_1_binding(Q),Z=!0},p(e,t){var a={};e.streamers&&(a.streamers=t.streamers),!v&&e.search&&(a.selected=t.search),le.$set(a),e.clustering_show&&(S.checked=t.clustering_show),e.potrait_show&&(D.checked=t.potrait_show),e.saturate_filter&&(P.checked=t.saturate_filter),e.name_show&&(Y.checked=t.name_show)},i(e){Z||(x(le.$$.fragment,e),Z=!0)},o(e){w(le.$$.fragment,e),Z=!1},d(a){a&&o(t),y(le),a&&(o(K),o(O)),e.canvas_1_binding(null),b(ee)}}}const R=6,S=0;function M(e,t,a){e.strokeStyle=a,e.fillStyle=a,e.globalAlpha=.5,e.fillRect(t.x,t.y,t.w,t.h),e.globalAlpha=1,e.lineWidth=S,e.strokeRect(t.x,t.y,t.w,t.h)}function V(e,t,a){let r,i,n,s=!0,c=!0,h=!0,o=!0,f=null,d=0,u=0,g=!1;const _=["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],m=[[[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],[[1,0,1,1],[1,1,0,1],[1,1,1,0],[0,1,1,1]],[[1,0,1,0],[0,1,0,1],[1,0,1,0],[0,1,0,1]],[[1,1,1,1],[0,0,0,0],[1,1,1,1],[0,0,0,0]],[[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1]]];return v(async()=>{const e=document.createElement("canvas"),t=e.getContext("2d");e.width=4,e.height=4;const l=[],p=[];for(let e=0;e<m.length;++e)for(let t=0;t<_.length;++t)l.push(x(e,_[t],_[(t+1)%_.length])),p.push(_[t]);function x(a,l,r=null,i=1){e.width=m[a].length,e.height=m[0].length,t.clearRect(0,0,e.width,e.height),t.fillStyle=l,t.globalAlpha=i;for(let l=0;l<e.width;++l)for(let r=0;r<e.height;++r)m[a][l][r]&&t.fillRect(l,r,1,1);if(r){t.fillStyle=r;for(let l=0;l<e.width;++l)for(let r=0;r<e.height;++r)m[a][l][r]||t.fillRect(l,r,1,1)}return t.createPattern(e,"repeat")}let w,y=r.getContext("2d"),b=document.createElement("canvas"),v=b.getContext("2d"),E=document.createElement("canvas"),k=E.getContext("2d");b.width=r.width,b.height=r.height,E.width=r.width,E.height=r.height,a("canvas",r.onmousemove=function(e){let t=e.target.getBoundingClientRect();d=e.clientX-t.left,u=e.clientY-t.top,g=!0},r),a("canvas",r.onmouseout=function(e){g=!1},r),a("streamers",n=await(async()=>{let e=await fetch(A+"/api/thin-streamers").then(e=>e.json()),t=await fetch(A+"/api/streamer-tsne-grid").then(e=>e.json()),a=await fetch(A+"/api/streamer-clusters").then(e=>e.json()),l=(await fetch(A+"/api/streamer-similarities").then(e=>e.json()),{}),i=[];for(let t of e)l[t.id]=t,t.cluster_index=-1,t.cluster_probability=-1;for(let e of a)l[e.streamer_id].cluster_index=e.cluster,l[e.streamer_id].cluster_probability=e.probability;let n=r.width/Math.ceil(Math.sqrt(e.length))-2*S,s=r.height/Math.ceil(Math.sqrt(e.length))-2*S;for(let t=0;t<Math.ceil(Math.sqrt(e.length));++t){i[t]=[];for(let a=0;a<Math.ceil(Math.sqrt(e.length));++a)i[t].push(null)}for(let e of t){let t=l[e.streamer_id];i[e.x][e.y]=t}return t.map(e=>{let t=l[e.streamer_id];t.x=(n+2*S)*e.x+S,t.y=(s+2*S)*e.y+S,t.w=n,t.h=s,t.cx=t.x+.5*t.w,t.cy=t.y+.5*t.h,t.cluster_index>=0&&(e.x-1<0||null==i[e.x-1][e.y]||i[e.x-1][e.y].cluster_index!=t.cluster_index)&&(t.left_edge=!0),t.cluster_index>=0&&(e.x+1>=i.length||null==i[e.x+1][e.y]||i[e.x+1][e.y].cluster_index!=t.cluster_index)&&(t.right_edge=!0),t.cluster_index>=0&&(e.y-1<0||null==i[e.x][e.y-1]||i[e.x][e.y-1].cluster_index!=t.cluster_index)&&(t.top_edge=!0),t.cluster_index>=0&&(e.y+1>=i.length||null==i[e.x][e.y+1]||i[e.x][e.y+1].cluster_index!=t.cluster_index)&&(t.bottom_edge=!0),t.image=new Image,t.image_loaded=!1,t.image_alpha=0,t.image.onload=function(){t.image_loaded=!0,v.drawImage(t.image,t.x,t.y,t.w,t.h)},t.image.src=t.profile_image_url,k.font="10px Arial";let a=t.x+R,r=t.w-2*R,c=k.measureText(t.name).width,h=Math.ceil(c/r),o=Math.floor(t.name.length/h),f=parseInt(k.font),d=f*h,u=t.y+t.h-d-R;k.globalAlpha=.5,k.fillStyle="#fff",k.fillRect(a,u,r,d),k.globalAlpha=1,k.fillStyle="#000",k.textBaseline="top",k.textAlign="center";for(let e=0;e<h-1;++e)k.fillText(t.name.substr(e*o,o),t.cx,u+e*f);return k.fillText(t.name.slice((h-1)*o),t.cx,u+(h-1)*f),t})})());let I=0;return y.font="11px Arial",function e(){w=requestAnimationFrame(e),y.clearRect(0,0,r.width,r.height),y.save(),o&&(y.filter="saturate(10%)"),c&&y.drawImage(b,0,0),y.restore();for(let e of n)if(s&&e.cluster_index>=0){p[e.cluster_index];let t=l[e.cluster_index];if(y.fillStyle=t,f&&e.cluster_index>-1&&f.cluster_index===e.cluster_index&&I%10>5);else{if(e.left_edge){let t=e.y,a=t+e.h;e.bottom_edge||(a+=R),e.top_edge||(t-=R),y.fillRect(e.x,t,R,a-t)}if(e.right_edge){let t=e.y,a=t+e.h;e.bottom_edge||(a+=R),e.top_edge||(t-=R),y.fillRect(e.x+e.w-R,t,R,a-t)}if(e.top_edge){let t=e.x,a=t+e.w;e.right_edge||(a+=R),e.left_edge||(t-=R),y.fillRect(t,e.y,a-t,R)}if(e.bottom_edge){let t=e.x,a=t+e.w;e.right_edge||(a+=R),e.left_edge||(t-=R),y.fillRect(t,e.y+e.h-R,a-t,R)}}}if(h&&y.drawImage(E,0,0),g){for(let e of n)d<e.x+e.w&&d>=e.x&&u<e.y+e.h&&u>=e.y&&(f=e);f&&(M(y,f,"#d4af37"),i&&f.id==i.id&&a("search",i=null))}else f=null;i&&I%10>5&&M(y,i,"#d4af37"),I+=1}(),()=>{cancelAnimationFrame(w)}}),{canvas:r,search:i,clustering_show:s,potrait_show:c,name_show:h,saturate_filter:o,streamers:n,streamerautocomplete_selected_binding:function(e){a("search",i=e)},input0_change_handler:function(){s=this.checked,a("clustering_show",s)},input1_change_handler:function(){c=this.checked,a("potrait_show",c)},input2_change_handler:function(){o=this.checked,a("saturate_filter",o)},input3_change_handler:function(){h=this.checked,a("name_show",h)},canvas_1_binding:function(e){l[e?"unshift":"push"](()=>{a("canvas",r=e)})}}}class $ extends e{constructor(e){super(),t(this,e,V,I,a,[])}}export{$ as S};
