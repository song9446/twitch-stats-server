import{_ as e,a as t,b as r,c as a,i as n,s as i,d as c,S as s,p as l,q as o,e as h,r as u,t as f,f as d,g as p,j as g,u as m,h as v,k as _,N as x,m as w,o as y,v as b,w as k,x as E,z as A,R as I,T as S,A as R}from"./index.b1484a97.js";import{_ as M,a as T}from"./asyncToGenerator.d19dc5d8.js";import{S as V}from"./StreamerAutoComplete.02c0bed2.js";function $(e){var t,r,a,n,i,c,s,S,M,T,$,j,D,L,C,q,B,N,P,U,F,z,G,W,X,Y,H,J,K,O,Q,Z,ee;function te(t){e.streamerautocomplete_selected_binding.call(null,t),a=!0,R(function(){return a=!1})}var re={streamers:e.streamers,placeholder:"지도에서 찾기"};void 0!==e.search&&(re.selected=e.search);var ae=new V({props:re});return l.push(function(){return o(ae,"selected",te)}),{c:function(){t=h("div"),r=h("div"),ae.$$.fragment.c(),n=u(),i=h("div"),c=h("div"),s=h("input"),S=u(),M=h("label"),T=f("국경"),$=u(),j=h("div"),D=h("input"),L=u(),C=h("label"),q=f("초상화"),B=u(),N=h("div"),P=h("input"),U=u(),F=h("label"),z=f("흑백"),G=u(),W=h("div"),X=h("input"),Y=u(),H=h("label"),J=f("이름"),K=u(),O=h("div"),Q=h("canvas"),this.h()},l:function(e){t=d(e,"DIV",{class:!0},!1);var a=p(t);r=d(a,"DIV",{class:!0},!1);var l=p(r);ae.$$.fragment.l(l),l.forEach(g),n=m(a),i=d(a,"DIV",{class:!0},!1);var o=p(i);c=d(o,"DIV",{class:!0},!1);var h=p(c);s=d(h,"INPUT",{type:!0,id:!0,name:!0},!1),p(s).forEach(g),S=m(h),M=d(h,"LABEL",{for:!0},!1);var u=p(M);T=v(u,"국경"),u.forEach(g),h.forEach(g),$=m(o),j=d(o,"DIV",{class:!0},!1);var f=p(j);D=d(f,"INPUT",{type:!0,id:!0,name:!0},!1),p(D).forEach(g),L=m(f),C=d(f,"LABEL",{for:!0},!1);var _=p(C);q=v(_,"초상화"),_.forEach(g),f.forEach(g),B=m(o),N=d(o,"DIV",{class:!0},!1);var x=p(N);P=d(x,"INPUT",{type:!0,id:!0,name:!0},!1),p(P).forEach(g),U=m(x),F=d(x,"LABEL",{for:!0},!1);var w=p(F);z=v(w,"흑백"),w.forEach(g),x.forEach(g),G=m(o),W=d(o,"DIV",{class:!0},!1);var y=p(W);X=d(y,"INPUT",{type:!0,id:!0,name:!0},!1),p(X).forEach(g),Y=m(y),H=d(y,"LABEL",{for:!0},!1);var b=p(H);J=v(b,"이름"),b.forEach(g),y.forEach(g),o.forEach(g),a.forEach(g),K=m(e),O=d(e,"DIV",{class:!0},!1);var k=p(O);Q=d(k,"CANVAS",{width:!0,height:!0},!1),p(Q).forEach(g),k.forEach(g),this.h()},h:function(){_(r,"class","p-2"),_(s,"type","checkbox"),_(s,"id","border"),_(s,"name","border"),_(M,"for","border"),_(c,"class","px-2"),_(D,"type","checkbox"),_(D,"id","potrait"),_(D,"name","potrait"),_(C,"for","potrait"),_(j,"class","px-2"),_(P,"type","checkbox"),_(P,"id","saturate"),_(P,"name","saturate"),_(F,"for","saturate"),_(N,"class","px-2"),_(X,"type","checkbox"),_(X,"id","name"),_(X,"name","name"),_(H,"for","name"),_(W,"class","px-2"),_(i,"class","p-2 flex flex-row flex-wrap items-center"),_(t,"class","w-full flex flex-row flex-wrap items-center my-4"),_(Q,"width","1280"),_(Q,"height","1280"),_(O,"class","overflow-x-auto container"),ee=[x(s,"change",e.input0_change_handler),x(D,"change",e.input1_change_handler),x(P,"change",e.input2_change_handler),x(X,"change",e.input3_change_handler)]},m:function(a,l){w(a,t,l),y(t,r),b(ae,r,null),y(t,n),y(t,i),y(i,c),y(c,s),s.checked=e.clustering_show,y(c,S),y(c,M),y(M,T),y(i,$),y(i,j),y(j,D),D.checked=e.potrait_show,y(j,L),y(j,C),y(C,q),y(i,B),y(i,N),y(N,P),P.checked=e.saturate_filter,y(N,U),y(N,F),y(F,z),y(i,G),y(i,W),y(W,X),X.checked=e.name_show,y(W,Y),y(W,H),y(H,J),w(a,K,l),w(a,O,l),y(O,Q),e.canvas_1_binding(Q),Z=!0},p:function(e,t){var r={};e.streamers&&(r.streamers=t.streamers),!a&&e.search&&(r.selected=t.search),ae.$set(r),e.clustering_show&&(s.checked=t.clustering_show),e.potrait_show&&(D.checked=t.potrait_show),e.saturate_filter&&(P.checked=t.saturate_filter),e.name_show&&(X.checked=t.name_show)},i:function(e){Z||(k(ae.$$.fragment,e),Z=!0)},o:function(e){E(ae.$$.fragment,e),Z=!1},d:function(r){r&&g(t),A(ae),r&&(g(K),g(O)),e.canvas_1_binding(null),I(ee)}}}var j=6,D=0;function L(e,t,r){e.strokeStyle=r,e.fillStyle=r,e.globalAlpha=.5,e.fillRect(t.x,t.y,t.w,t.h),e.globalAlpha=1,e.lineWidth=D,e.strokeRect(t.x,t.y,t.w,t.h)}function C(e,t,r){var a,n,i,c=!0,s=!0,o=!0,h=!0,u=null,f=0,d=0,p=!1,g=["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],m=[[[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],[[1,0,1,1],[1,1,0,1],[1,1,1,0],[0,1,1,1]],[[1,0,1,0],[0,1,0,1],[1,0,1,0],[0,1,0,1]],[[1,1,1,1],[0,0,0,0],[1,1,1,1],[0,0,0,0]],[[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1]]];return S(M(T.mark(function e(){var t,l,v,_,x,w,y,b,k,E,A,I,S,R;return T.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(y=function(e,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;t.width=m[e].length,t.height=m[0].length,l.clearRect(0,0,t.width,t.height),l.fillStyle=r,l.globalAlpha=n;for(var i=0;i<t.width;++i)for(var c=0;c<t.height;++c)m[e][i][c]&&l.fillRect(i,c,1,1);if(a){l.fillStyle=a;for(var s=0;s<t.width;++s)for(var o=0;o<t.height;++o)m[e][s][o]||l.fillRect(s,o,1,1)}return l.createPattern(t,"repeat")},t=document.createElement("canvas"),l=t.getContext("2d"),t.width=4,t.height=4,v=[],_=[],x=0;x<m.length;++x)for(w=0;w<g.length;++w)v.push(y(x,g[w],g[(w+1)%g.length])),_.push(g[w]);return b=a.getContext("2d"),k=document.createElement("canvas"),E=k.getContext("2d"),A=document.createElement("canvas"),I=A.getContext("2d"),k.width=a.width,k.height=a.height,A.width=a.width,A.height=a.height,r("canvas",a.onmousemove=function(e){var t=e.target.getBoundingClientRect();f=e.clientX-t.left,d=e.clientY-t.top,p=!0},a),r("canvas",a.onmouseout=function(e){p=!1},a),e.t0=r,e.next=19,M(T.mark(function e(){var t,r,n,i,c,s,l,o,h,u,f,d,p,g,m,v,_,x,w,y,b,k,A,S,R,M,V,$;return T.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/thin-streamers").then(function(e){return e.json()});case 2:return t=e.sent,e.next=5,fetch("/api/streamer-tsne-grid").then(function(e){return e.json()});case 5:return r=e.sent,e.next=8,fetch("/api/streamer-clusters").then(function(e){return e.json()});case 8:return n=e.sent,e.next=11,fetch("/api/streamer-similarities").then(function(e){return e.json()});case 11:for(e.sent,i={},c=[],s=!0,l=!1,o=void 0,e.prev=18,h=t[Symbol.iterator]();!(s=(u=h.next()).done);s=!0)f=u.value,i[f.id]=f,f.cluster_index=-1,f.cluster_probability=-1;e.next=26;break;case 22:e.prev=22,e.t0=e.catch(18),l=!0,o=e.t0;case 26:e.prev=26,e.prev=27,s||null==h.return||h.return();case 29:if(e.prev=29,!l){e.next=32;break}throw o;case 32:return e.finish(29);case 33:return e.finish(26);case 34:for(d=!0,p=!1,g=void 0,e.prev=37,m=n[Symbol.iterator]();!(d=(v=m.next()).done);d=!0)_=v.value,i[_.streamer_id].cluster_index=_.cluster,i[_.streamer_id].cluster_probability=_.probability;e.next=45;break;case 41:e.prev=41,e.t1=e.catch(37),p=!0,g=e.t1;case 45:e.prev=45,e.prev=46,d||null==m.return||m.return();case 48:if(e.prev=48,!p){e.next=51;break}throw g;case 51:return e.finish(48);case 52:return e.finish(45);case 53:for(x=a.width/Math.ceil(Math.sqrt(t.length))-2*D,w=a.height/Math.ceil(Math.sqrt(t.length))-2*D,y=0;y<Math.ceil(Math.sqrt(t.length));++y)for(c[y]=[],b=0;b<Math.ceil(Math.sqrt(t.length));++b)c[y].push(null);for(k=!0,A=!1,S=void 0,e.prev=58,R=r[Symbol.iterator]();!(k=(M=R.next()).done);k=!0)V=M.value,$=i[V.streamer_id],c[V.x][V.y]=$;e.next=66;break;case 62:e.prev=62,e.t2=e.catch(58),A=!0,S=e.t2;case 66:e.prev=66,e.prev=67,k||null==R.return||R.return();case 69:if(e.prev=69,!A){e.next=72;break}throw S;case 72:return e.finish(69);case 73:return e.finish(66);case 74:return e.abrupt("return",r.map(function(e){var t=i[e.streamer_id];t.x=(x+2*D)*e.x+D,t.y=(w+2*D)*e.y+D,t.w=x,t.h=w,t.cx=t.x+.5*t.w,t.cy=t.y+.5*t.h,t.cluster_index>=0&&(e.x-1<0||null==c[e.x-1][e.y]||c[e.x-1][e.y].cluster_index!=t.cluster_index)&&(t.left_edge=!0),t.cluster_index>=0&&(e.x+1>=c.length||null==c[e.x+1][e.y]||c[e.x+1][e.y].cluster_index!=t.cluster_index)&&(t.right_edge=!0),t.cluster_index>=0&&(e.y-1<0||null==c[e.x][e.y-1]||c[e.x][e.y-1].cluster_index!=t.cluster_index)&&(t.top_edge=!0),t.cluster_index>=0&&(e.y+1>=c.length||null==c[e.x][e.y+1]||c[e.x][e.y+1].cluster_index!=t.cluster_index)&&(t.bottom_edge=!0),t.image=new Image,t.image_loaded=!1,t.image_alpha=0,t.image.onload=function(){t.image_loaded=!0,E.drawImage(t.image,t.x,t.y,t.w,t.h)},t.image.src=t.profile_image_url,I.font="10px Arial";var r=t.x+j,a=t.w-2*j,n=I.measureText(t.name).width,s=Math.ceil(n/a),l=Math.floor(t.name.length/s),o=parseInt(I.font),h=o*s,u=t.y+t.h-h-j;I.globalAlpha=.5,I.fillStyle="#fff",I.fillRect(r,u,a,h),I.globalAlpha=1,I.fillStyle="#000",I.textBaseline="top",I.textAlign="center";for(var f=0;f<s-1;++f)I.fillText(t.name.substr(f*l,l),t.cx,u+f*o);return I.fillText(t.name.slice((s-1)*l),t.cx,u+(s-1)*o),t}));case 76:case"end":return e.stop()}},e,null,[[18,22,26,34],[27,,29,33],[37,41,45,53],[46,,48,52],[58,62,66,74],[67,,69,73]])}))();case 19:return e.t1=i=e.sent,(0,e.t0)("streamers",e.t1),R=0,b.font="11px Arial",function e(){S=requestAnimationFrame(e),b.clearRect(0,0,a.width,a.height),b.save(),h&&(b.filter="saturate(10%)"),s&&b.drawImage(k,0,0),b.restore();var t=!0,l=!1,g=void 0;try{for(var m,x=i[Symbol.iterator]();!(t=(m=x.next()).done);t=!0){var w=m.value;if(c&&w.cluster_index>=0){_[w.cluster_index];var y=v[w.cluster_index];if(b.fillStyle=y,u&&w.cluster_index>-1&&u.cluster_index===w.cluster_index&&R%10>5);else{if(w.left_edge){var E=w.y,I=E+w.h;w.bottom_edge||(I+=j),w.top_edge||(E-=j),b.fillRect(w.x,E,j,I-E)}if(w.right_edge){var M=w.y,T=M+w.h;w.bottom_edge||(T+=j),w.top_edge||(M-=j),b.fillRect(w.x+w.w-j,M,j,T-M)}if(w.top_edge){var V=w.x,$=V+w.w;w.right_edge||($+=j),w.left_edge||(V-=j),b.fillRect(V,w.y,$-V,j)}if(w.bottom_edge){var D=w.x,C=D+w.w;w.right_edge||(C+=j),w.left_edge||(D-=j),b.fillRect(D,w.y+w.h-j,C-D,j)}}}}}catch(e){l=!0,g=e}finally{try{t||null==x.return||x.return()}finally{if(l)throw g}}if(o&&b.drawImage(A,0,0),p){var q=!0,B=!1,N=void 0;try{for(var P,U=i[Symbol.iterator]();!(q=(P=U.next()).done);q=!0){var F=P.value;f<F.x+F.w&&f>=F.x&&d<F.y+F.h&&d>=F.y&&(u=F)}}catch(e){B=!0,N=e}finally{try{q||null==U.return||U.return()}finally{if(B)throw N}}u&&(L(b,u,"#d4af37"),n&&u.id==n.id&&r("search",n=null))}else u=null;n&&R%10>5&&L(b,n,"#d4af37"),R+=1}(),e.abrupt("return",function(){cancelAnimationFrame(S)});case 26:case"end":return e.stop()}},e)}))),{canvas:a,search:n,clustering_show:c,potrait_show:s,name_show:o,saturate_filter:h,streamers:i,streamerautocomplete_selected_binding:function(e){r("search",n=e)},input0_change_handler:function(){c=this.checked,r("clustering_show",c)},input1_change_handler:function(){s=this.checked,r("potrait_show",s)},input2_change_handler:function(){h=this.checked,r("saturate_filter",h)},input3_change_handler:function(){o=this.checked,r("name_show",o)},canvas_1_binding:function(e){l[e?"unshift":"push"](function(){r("canvas",a=e)})}}}var q=function(l){function o(e){var s;return t(this,o),s=r(this,a(o).call(this)),n(c(s),e,C,$,i,[]),s}return e(o,s),o}();export{q as S};
