<!DOCTYPE HTML>
<html>
    <title> </title>
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <section>
        <h1> 스트리머 지도 </h1>
        <canvas id="streamer-tsne-grid-canvas" width=1024 height=1024>
        </canvas>
        <script> 
(async() => {
const streamers = await fetch("/api/streamers").then(res => res.json());
const streamers_tsne_grid = await fetch("/api/streamer-tsne-grid").then(res=>res.json());
const streamer_by_id = {}
for(streamer of streamers)
    streamer_by_id[streamer["id"]] = streamer;

const canvas = document.getElementById("streamer-tsne-grid-canvas"),
    ctx = canvas.getContext("2d"),
    dim = Math.ceil(Math.sqrt(streamers.length)),
    profile_width = canvas.width/dim,
    profile_height = canvas.height/dim;
    ctx.textAlign="left";
    ctx.textBaseline = "top";
    ctx.font="15px";
for(let v of streamers_tsne_grid){
    let streamer = streamer_by_id[v.streamer_id],
        x = v.x*profile_width, 
        y = v.y*profile_height;
    streamer.image = new Image;
    streamer.image.onload = function(){
        ctx.drawImage(streamer.image, x, y, profile_width, profile_height);

        ctx.fillStyle = '#fff';
        x += 5; y += 5;
        let s = 2;
        ctx.fillText(streamer.name, x-s, y-s);
        ctx.fillText(streamer.name, x-s, y);
        ctx.fillText(streamer.name, x-s, y+s);
        ctx.fillText(streamer.name, x+s, y-s);
        ctx.fillText(streamer.name, x+s, y);
        ctx.fillText(streamer.name, x+s, y+s);
        ctx.fillText(streamer.name, x, y+s);
        ctx.fillText(streamer.name, x, y-s);
        ctx.fillText(streamer.name, x, y);

        ctx.fillStyle = '#000';
        ctx.fillText(streamer.name, x, y);
        ctx.strokeText(streamer.name, x, y);
    }
    streamer.image.src = streamer.profile_image_url;
}
})();

        </script>
    </section>
</body>
</html>
